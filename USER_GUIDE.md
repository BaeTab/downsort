# DownSort 사용자 가이드

## 목차
1. [시작하기](#시작하기)
2. [규칙 작성하기](#규칙-작성하기)
3. [파일 정리하기](#파일-정리하기)
4. [실행 취소 (Undo)](#실행-취소-undo)
5. [설정](#설정)
6. [주의사항](#주의사항)
7. [문제 해결](#문제-해결)

---

## 시작하기

### 첫 실행

1. **DownSort.exe**를 실행합니다.
2. 애플리케이션이 처음 실행되면 다음 항목이 자동으로 생성됩니다:
   - 기본 설정 파일 (`%LocalAppData%\DownSort\settings.json`)
   - 6개의 기본 규칙 (Documents, Images, Archives, Installers, Videos, Audio)
   - 빈 로그 파일

3. 메인 화면이 열리면 3개의 주요 패널을 볼 수 있습니다:
   - **좌측**: 규칙 목록
   - **우측 상단**: 미리보기/결과
   - **우측 하단**: 최근 로그

### 기본 규칙 이해하기

기본 규칙은 다음과 같이 구성되어 있습니다:

| 규칙 이름    | 대상 확장자                                      | 대상 폴더                    |
|-------------|------------------------------------------------|----------------------------|
| Documents   | pdf, doc, docx, xls, xlsx, ppt, pptx, txt, ... | Downloads\Documents\       |
| Images      | jpg, jpeg, png, gif, bmp, svg, webp, ico       | Downloads\Images\          |
| Archives    | zip, rar, 7z, tar, gz, bz2                     | Downloads\Archives\        |
| Installers  | exe, msi, dmg, pkg                             | Downloads\Installers\      |
| Videos      | mp4, avi, mkv, mov, wmv, flv, webm             | Downloads\Videos\          |
| Audio       | mp3, wav, flac, aac, ogg, wma, m4a             | Downloads\Audio\           |

---

## 규칙 작성하기

### 규칙의 구성 요소

각 규칙은 다음과 같은 요소로 구성됩니다:

1. **활성화 (Enabled)**: 체크박스를 통해 규칙을 활성화/비활성화
2. **우선순위 (Priority)**: 낮은 숫자가 높은 우선순위 (1이 가장 높음)
3. **이름 (Name)**: 규칙의 식별 이름
4. **분류 (Category)**: 파일 분류명 (대상 경로 템플릿에서 사용)
5. **확장자 (Extensions)**: 대상 파일 확장자 목록
6. **포함 키워드 (IncludeKeywords)**: 파일명에 포함되어야 하는 단어
7. **제외 키워드 (ExcludeKeywords)**: 파일명에 포함되면 안 되는 단어
8. **정규식 패턴 (RegexPattern)**: 고급 파일명 매칭
9. **파일 크기 (MinSize/MaxSize)**: 최소/최대 파일 크기 (바이트)
10. **생성/수정 날짜 (MinCreated/MaxCreated)**: 날짜 범위
11. **작업 유형 (ActionType)**: Move, Copy, Rename, Delete
12. **대상 템플릿 (TargetTemplate)**: 대상 폴더 경로
13. **처리 중지 (StopProcessingFurtherRules)**: 매칭 후 다른 규칙 평가 중지

### 새 규칙 만들기

#### 예제 1: 청구서 파일 자동 정리

**요구사항**: 파일명에 "invoice" 또는 "receipt"가 포함된 PDF 파일을 `Downloads\Invoices\연도\월\` 폴더로 이동

1. 규칙 패널에서 "새 규칙" 버튼 클릭
2. 다음과 같이 설정:
   - **이름**: `Invoices`
   - **분류**: `Invoices`
   - **확장자**: `pdf`
   - **포함 키워드**: `invoice`, `receipt`
   - **작업 유형**: `Move`
   - **대상 템플릿**: `{Downloads}\Invoices\{YYYY}\{MM}\`
3. 저장

#### 예제 2: 대용량 비디오 파일 필터링

**요구사항**: 100MB 이상의 비디오 파일만 정리

1. 새 규칙 생성
2. 설정:
   - **이름**: `Large Videos`
   - **분류**: `LargeVideos`
   - **확장자**: `mp4`, `avi`, `mkv`, `mov`
   - **최소 크기**: `104857600` (100MB in bytes)
   - **작업 유형**: `Move`
   - **대상 템플릿**: `{Downloads}\LargeVideos\`

#### 예제 3: 임시 파일 제외

**요구사항**: "temp" 또는 "tmp"가 포함된 파일은 정리하지 않음

1. 새 규칙 생성
2. 설정:
   - **이름**: `Exclude Temp Files`
   - **우선순위**: `1` (가장 높게)
   - **제외 키워드**: `temp`, `tmp`, `temporary`
   - **작업 유형**: `Move`
   - **대상 템플릿**: `{Downloads}\` (원래 위치)
   - **처리 중지**: `True`

### 대상 경로 템플릿 매크로

다음 매크로를 대상 경로에 사용할 수 있습니다:

| 매크로              | 설명                    | 예시               |
|--------------------|------------------------|-------------------|
| `{Downloads}`      | 다운로드 폴더 경로       | `C:\Users\...\Downloads` |
| `{Category}`       | 규칙의 분류명           | `Documents`       |
| `{Ext}`            | 파일 확장자 (점 제외)    | `pdf`             |
| `{YYYY}`           | 현재 연도 (4자리)       | `2025`            |
| `{MM}`             | 현재 월 (2자리)         | `01`              |
| `{DD}`             | 현재 일 (2자리)         | `15`              |
| `{Today}`          | 오늘 날짜              | `2025-01-15`      |
| `{SourceFolderName}` | 원본 폴더 이름        | `Downloads`       |
| `{FileName}`       | 파일명 (확장자 제외)     | `document`        |

**예시**:
- `{Downloads}\{Category}\{YYYY}\{MM}\` → `C:\Users\...\Downloads\Documents\2025\01\`
- `D:\Sorted\{Ext}\{Today}\` → `D:\Sorted\pdf\2025-01-15\`

---

## 파일 정리하기

### 자동 모드 (실시간 감시)

1. 상단 툴바에서 **"감시 시작/중지"** 버튼을 클릭합니다.
2. 상태 표시줄에 "파일 감시 중..."이 표시됩니다.
3. 다운로드 폴더에 새 파일이 생성되면 자동으로 규칙에 따라 정리됩니다.
4. 최근 로그 패널에서 처리 결과를 실시간으로 확인할 수 있습니다.

**주의**: 파일이 완전히 다운로드될 때까지 기다립니다. 잠긴 파일은 최대 30초간 대기합니다.

### 수동 모드 (미리보기 및 선택 실행)

1. **"스캔"** 버튼을 클릭합니다.
2. 현재 감시 폴더의 모든 파일이 스캔되고, 각 파일에 대한 예상 작업이 표시됩니다.
3. 미리보기 패널에서 다음 정보를 확인할 수 있습니다:
   - 파일명, 확장자, 크기
   - 수행될 작업 (Move, Copy 등)
   - 대상 경로
   - 매칭된 규칙
   - 충돌 여부

4. 원하는 파일만 선택합니다 (기본적으로 모두 선택됨).
5. **"선택 실행"** 버튼을 클릭합니다.
6. 처리가 완료되면 상태 메시지에 결과가 표시됩니다.

### 처리 결과 확인

- **성공**: 파일이 정상적으로 이동/복사됨
- **건너뜀**: 이름 충돌 또는 조건 불일치
- **실패**: 오류 발생 (오류 메시지 참조)

---

## 실행 취소 (Undo)

### 사용 방법

1. **"실행 취소"** 버튼을 클릭합니다.
2. 가장 최근에 수행된 이동 작업이 원복됩니다.
3. 여러 번 클릭하여 여러 단계를 취소할 수 있습니다 (최대 100단계).

### Undo 가능한 작업

- ? **Move (이동)**: 원본 위치로 복원
- ? **Copy (복사)**: 취소 불가 (복사본만 생성)
- ? **Delete (삭제)**: 취소 불가 (영구 삭제)

### 주의사항

- 대상 파일이 이미 삭제되었거나 이동된 경우 Undo가 실패할 수 있습니다.
- 원본 위치에 동일한 이름의 파일이 존재하는 경우 `_restored_1`, `_restored_2` 등의 이름으로 복원됩니다.

---

## 설정

### 일반 설정

- **감시 폴더**: 추가/제거 버튼으로 여러 폴더를 감시할 수 있습니다.
- **언어**: 한국어 (ko-KR), 영어 (en-US) [향후 지원]
- **테마**: 라이트/다크 [향후 지원]
- **시작 옵션**:
  - Windows 시작 시 자동 실행
  - 트레이로 시작 [향후 지원]
  - 감시 자동 시작

### 성능 설정

- **동시 처리 작업 수** (기본: 4): 여러 파일을 동시에 처리하는 스레드 수
  - 높은 값: 빠른 처리, 높은 CPU 사용
  - 낮은 값: 느린 처리, 낮은 CPU 사용

- **대용량 파일 임계치** (기본: 2GB): 이 크기 이상의 파일은 진행률 표시
  
- **파일 잠금 폴링 최대 대기 시간** (기본: 30초): 잠긴 파일의 최대 대기 시간

### 보관 설정

- **로그 보존 기간** (기본: 90일): 이 기간이 지난 로그는 자동 삭제
- **Undo 스택 크기** (기본: 100): 저장할 Undo 항목의 최대 개수

### 고급 설정

- **이름 충돌 전략**:
  - **자동 리네임** (권장): `file_1.txt`, `file_2.txt` 등으로 자동 이름 변경
  - **건너뛰기**: 충돌 시 작업 건너뛰기
  - **덮어쓰기** (주의): 기존 파일 삭제 후 이동

- **삭제 동작 확인**: 삭제 작업 수행 전 확인 대화상자 표시

---

## 주의사항

### 안전 수칙

1. **백업**: 중요한 파일은 정리 전에 백업하세요.
2. **테스트**: 새 규칙은 먼저 수동 모드(미리보기)로 테스트하세요.
3. **권한**: 대상 폴더에 쓰기 권한이 있는지 확인하세요.
4. **네트워크 드라이브**: 네트워크 드라이브는 성능이 느릴 수 있으니 주의하세요.

### 제한 사항

- **Windows 전용**: Linux/Mac에서는 실행되지 않습니다.
- **경로 길이**: Windows 최대 경로 길이(260자) 제한이 적용됩니다.
- **파일 잠금**: 다른 프로그램이 사용 중인 파일은 처리되지 않습니다.
- **Junction/심볼릭 링크**: 무한 루프 방지를 위해 건너뜁니다.

### 권장 사항

- 규칙 우선순위를 신중하게 설정하세요.
- "제외 키워드" 규칙을 높은 우선순위로 설정하여 중요한 파일을 보호하세요.
- 정기적으로 로그를 확인하여 예상대로 동작하는지 점검하세요.

---

## 문제 해결

### Q1: 파일이 정리되지 않아요

**원인**:
- 규칙이 비활성화되어 있을 수 있습니다.
- 파일이 규칙의 조건과 일치하지 않을 수 있습니다.
- 파일이 잠겨 있을 수 있습니다.

**해결**:
1. 규칙 패널에서 규칙이 활성화(체크됨)되어 있는지 확인하세요.
2. 스캔 버튼으로 미리보기를 확인하여 매칭 여부를 점검하세요.
3. 다른 프로그램이 파일을 사용 중인지 확인하세요.

### Q2: "권한이 거부되었습니다" 오류가 발생해요

**원인**:
- 대상 폴더에 쓰기 권한이 없습니다.
- 파일이 읽기 전용입니다.

**해결**:
1. DownSort를 관리자 권한으로 실행하세요.
2. 대상 폴더의 권한 설정을 확인하세요.
3. 파일의 속성에서 읽기 전용을 해제하세요.

### Q3: 애플리케이션이 느려요

**원인**:
- 너무 많은 파일을 동시에 처리 중입니다.
- 네트워크 드라이브를 사용 중입니다.

**해결**:
1. 설정에서 "동시 처리 작업 수"를 줄이세요 (예: 2).
2. 감시 폴더 수를 줄이세요.
3. 로컬 드라이브만 사용하세요.

### Q4: Undo가 작동하지 않아요

**원인**:
- 복사 또는 삭제 작업은 Undo가 불가능합니다.
- 대상 파일이 이미 이동되었거나 삭제되었습니다.

**해결**:
- 이동(Move) 작업만 Undo가 가능합니다.
- 파일을 수동으로 복원하세요.

### Q5: 설정이 저장되지 않아요

**원인**:
- `%LocalAppData%\DownSort\` 폴더에 쓰기 권한이 없습니다.

**해결**:
1. 폴더 권한을 확인하세요.
2. 애플리케이션을 관리자 권한으로 실행하세요.

---

## 추가 도움말

더 많은 정보와 최신 업데이트는 다음을 참고하세요:

- **GitHub Repository**: [github.com/your-repo/downsort]
- **Issues**: 버그 리포트 및 기능 제안
- **Wiki**: 고급 사용법 및 팁

---

**DownSort 팀** | 2025
