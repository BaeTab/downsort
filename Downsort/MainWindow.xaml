<dx:ThemedWindow
    x:Class="Downsort.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxdo="http://schemas.devexpress.com/winfx/2008/xaml/docking"
    Title="DownSort - Smart File Organizer" 
    Height="850" 
    Width="1500"
    WindowStartupLocation="CenterScreen"
    Background="#F5F7FA">
    
    <dx:ThemedWindow.Resources>
        <PathGeometry x:Key="WatchIcon">M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.7L16.2,16.2Z</PathGeometry>
        <PathGeometry x:Key="ScanIcon">M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z</PathGeometry>
        <PathGeometry x:Key="PlayIcon">M8,5.14V19.14L19,12.14L8,5.14Z</PathGeometry>
        <PathGeometry x:Key="UndoIcon">M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z</PathGeometry>
        <PathGeometry x:Key="ClearIcon">M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z</PathGeometry>
    </dx:ThemedWindow.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#FFFFFF" Offset="0"/>
                    <GradientStop Color="#F8F9FA" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect Color="#10000000" BlurRadius="5" ShadowDepth="2" Opacity="0.2"/>
            </Border.Effect>
            
            <Grid Margin="15,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <WrapPanel Grid.Column="0" VerticalAlignment="Center">
                    <Button Command="{Binding ToggleWatcherCommand}" 
                            Style="{StaticResource ModernButtonStyle}"
                            Background="{StaticResource SuccessButtonBrush}"
                            Foreground="White">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource WatchIcon}" Fill="White" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                            <TextBlock Text="Watch" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding ScanCommand}" 
                            Style="{StaticResource ModernButtonStyle}"
                            Background="{StaticResource PrimaryButtonBrush}"
                            Foreground="White">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource ScanIcon}" Fill="White" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                            <TextBlock Text="Scan" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding ExecuteSelectedCommand}" 
                            Style="{StaticResource ModernButtonStyle}"
                            Background="{StaticResource WarningButtonBrush}"
                            Foreground="White">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource PlayIcon}" Fill="White" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                            <TextBlock Text="Execute" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding UndoLastCommand}" 
                            Style="{StaticResource ModernButtonStyle}"
                            Background="{StaticResource InfoButtonBrush}"
                            Foreground="White">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource UndoIcon}" Fill="White" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                            <TextBlock Text="Undo" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding ClearPreviewCommand}" 
                            Style="{StaticResource ModernButtonStyle}"
                            Background="{StaticResource SecondaryButtonBrush}"
                            Foreground="White">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource ClearIcon}" Fill="White" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                            <TextBlock Text="Clear" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </WrapPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Border Style="{StaticResource StatusBadgeStyle}" Background="#E3F2FD">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Status:" FontWeight="SemiBold" Foreground="#1976D2" Margin="0,0,5,0"/>
                            <TextBlock Text="{Binding StatusMessage}" Foreground="#1565C0" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Border>
                    
                    <Border Style="{StaticResource StatusBadgeStyle}" Background="#E8F5E9">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Done:" FontWeight="SemiBold" Foreground="#388E3C" Margin="0,0,5,0"/>
                            <TextBlock Text="{Binding ProcessedCount}" Foreground="#2E7D32" FontWeight="Bold"/>
                        </StackPanel>
                    </Border>
                    
                    <Border Style="{StaticResource StatusBadgeStyle}" Background="#FFF3E0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Queue:" FontWeight="SemiBold" Foreground="#F57C00" Margin="0,0,5,0"/>
                            <TextBlock Text="{Binding QueuedCount}" Foreground="#E65100" FontWeight="Bold"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>

        <dxdo:DockLayoutManager Grid.Row="1" Margin="10">
            <dxdo:LayoutGroup Orientation="Horizontal">
                
                <dxdo:LayoutPanel Caption="Active Rules" ItemWidth="380">
                    <dxg:GridControl ItemsSource="{Binding Rules}" SelectionMode="Row" Background="White">
                        <dxg:GridControl.View>
                            <dxg:TableView ShowGroupPanel="False" AutoWidth="True" AllowEditing="True" ShowIndicator="False" NavigationStyle="Cell" AlternateRowBackground="#F9FAFB"/>
                        </dxg:GridControl.View>
                        <dxg:GridControl.Columns>
                            <dxg:GridColumn FieldName="Enabled" Header="Active" Width="60"/>
                            <dxg:GridColumn FieldName="Priority" Header="Priority" Width="70"/>
                            <dxg:GridColumn FieldName="Name" Header="Rule Name" Width="160"/>
                            <dxg:GridColumn FieldName="Category" Header="Category" Width="90"/>
                        </dxg:GridControl.Columns>
                    </dxg:GridControl>
                </dxdo:LayoutPanel>

                <dxdo:LayoutGroup Orientation="Vertical">
                    
                    <dxdo:LayoutPanel Caption="Preview / Results" ItemHeight="*">
                        <dxg:GridControl ItemsSource="{Binding PreviewItems}" SelectionMode="Row" Background="White">
                            <dxg:GridControl.View>
                                <dxg:TableView ShowGroupPanel="False" AutoWidth="False" AllowEditing="False" ShowIndicator="True" NavigationStyle="Row" AlternateRowBackground="#F9FAFB"/>
                            </dxg:GridControl.View>
                            <dxg:GridControl.Columns>
                                <dxg:GridColumn FieldName="IsSelected" Header="Select" Width="60"/>
                                <dxg:GridColumn FieldName="Source.Name" Header="File Name" Width="240"/>
                                <dxg:GridColumn FieldName="Source.Extension" Header="Type" Width="60"/>
                                <dxg:GridColumn FieldName="Source.SizeBytes" Header="Size" Width="100"/>
                                <dxg:GridColumn FieldName="ActionType" Header="Action" Width="70"/>
                                <dxg:GridColumn FieldName="TargetPath" Header="Target Path" Width="350"/>
                                <dxg:GridColumn FieldName="MatchedRule.Name" Header="Rule" Width="110"/>
                                <dxg:GridColumn FieldName="Status" Header="Status" Width="80"/>
                            </dxg:GridControl.Columns>
                        </dxg:GridControl>
                    </dxdo:LayoutPanel>

                    <dxdo:LayoutPanel Caption="Recent Activity" ItemHeight="220">
                        <dxg:GridControl ItemsSource="{Binding RecentLogs}" SelectionMode="Row" Background="White">
                            <dxg:GridControl.View>
                                <dxg:TableView ShowGroupPanel="False" AutoWidth="False" AllowEditing="False" ShowIndicator="False" NavigationStyle="Row" RowDoubleClick="OnRecentLogDoubleClick" AlternateRowBackground="#F9FAFB"/>
                            </dxg:GridControl.View>
                            <dxg:GridControl.Columns>
                                <dxg:GridColumn FieldName="Timestamp" Header="Time" Width="120">
                                    <dxg:GridColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding RowData.Row.Timestamp, StringFormat='HH:mm:ss'}" ToolTip="{Binding RowData.Row.Timestamp, StringFormat='yyyy-MM-dd HH:mm:ss'}" FontFamily="Consolas"/>
                                        </DataTemplate>
                                    </dxg:GridColumn.CellTemplate>
                                </dxg:GridColumn>
                                <dxg:GridColumn FieldName="ActionType" Header="Action" Width="70"/>
                                <dxg:GridColumn FieldName="SourcePath" Header="Source" Width="280">
                                    <dxg:GridColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding RowData.Row.SourcePath}" TextTrimming="CharacterEllipsis" ToolTip="{Binding RowData.Row.SourcePath}"/>
                                        </DataTemplate>
                                    </dxg:GridColumn.CellTemplate>
                                </dxg:GridColumn>
                                <dxg:GridColumn FieldName="TargetPath" Header="Target" Width="280">
                                    <dxg:GridColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding RowData.Row.TargetPath}" TextTrimming="CharacterEllipsis" ToolTip="{Binding RowData.Row.TargetPath}"/>
                                        </DataTemplate>
                                    </dxg:GridColumn.CellTemplate>
                                </dxg:GridColumn>
                                <dxg:GridColumn FieldName="RuleName" Header="Rule" Width="100"/>
                                <dxg:GridColumn FieldName="Result" Header="Result" Width="90">
                                    <dxg:GridColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="10" Padding="8,3" HorizontalAlignment="Center">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Success">
                                                                <Setter Property="Background" Value="#E8F5E9"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Failed">
                                                                <Setter Property="Background" Value="#FFEBEE"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Skipped">
                                                                <Setter Property="Background" Value="#FFF3E0"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <TextBlock Text="{Binding RowData.Row.Result}" FontSize="10" FontWeight="Bold">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Success">
                                                                    <Setter Property="Foreground" Value="#2E7D32"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Failed">
                                                                    <Setter Property="Foreground" Value="#C62828"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Skipped">
                                                                    <Setter Property="Foreground" Value="#EF6C00"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Border>
                                        </DataTemplate>
                                    </dxg:GridColumn.CellTemplate>
                                </dxg:GridColumn>
                                <dxg:GridColumn Width="90">
                                    <dxg:GridColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="Open" Command="{Binding DataContext.OpenFolderCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}" CommandParameter="{Binding RowData.Row}" Padding="8,4" FontSize="11" FontWeight="SemiBold" Background="{StaticResource PrimaryButtonBrush}" Foreground="White" BorderThickness="0" Cursor="Hand"/>
                                        </DataTemplate>
                                    </dxg:GridColumn.CellTemplate>
                                </dxg:GridColumn>
                            </dxg:GridControl.Columns>
                        </dxg:GridControl>
                    </dxdo:LayoutPanel>
                </dxdo:LayoutGroup>
                
            </dxdo:LayoutGroup>
        </dxdo:DockLayoutManager>

        <Border Grid.Row="2" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0" Background="#FAFBFC" Height="35">
            <Grid Margin="15,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse Width="8" Height="8" Margin="0,0,8,0">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill" Value="#FF5722"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsWatcherRunning}" Value="True">
                                        <Setter Property="Fill" Value="#4CAF50"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock Text="{Binding StatusMessage}" FontSize="12" FontWeight="SemiBold" Foreground="#546E7A"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Monitoring: " FontSize="11" Foreground="#78909C" Margin="0,0,5,0"/>
                    <TextBlock FontSize="11" FontWeight="Bold">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="OFF"/>
                                <Setter Property="Foreground" Value="#F44336"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsWatcherRunning}" Value="True">
                                        <Setter Property="Text" Value="ON"/>
                                        <Setter Property="Foreground" Value="#4CAF50"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</dx:ThemedWindow>
