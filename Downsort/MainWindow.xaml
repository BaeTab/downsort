<dx:ThemedWindow
 x:Class="Downsort.MainWindow"
 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
 xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
 xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
 xmlns:dxdo="http://schemas.devexpress.com/winfx/2008/xaml/docking"
 xmlns:dxr="http://schemas.devexpress.com/winfx/2008/xaml/ribbon"
 xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
 Title="DownSort - Smart File Organizer"
 Height="850"
 Width="1500"
 WindowStartupLocation="CenterScreen"
 Background="#F5F7FA"
 WindowKind="Ribbon"
 EnableAcrylic="True"
 AcrylicOpacity="0.65"
 AcrylicColor="#CC0A2540">

 <dx:ThemedWindow.Resources>
 <!-- App-level resources can be defined here if needed -->
 </dx:ThemedWindow.Resources>

 <DockPanel LastChildFill="True">
 <!-- Ribbon -->
 <dxr:RibbonControl DockPanel.Dock="Top" RibbonStyle="Office2019" ShowApplicationButton="False">
 <dxr:RibbonDefaultPageCategory>
 <dxr:RibbonPage Caption="Home">
 <dxr:RibbonPageGroup Caption="Actions">
 <dxb:BarButtonItem Content="Watch"
 LargeGlyph="{dx:DXImage SvgImages/Icon Builder/Programming_Watch.svg}"
 Command="{Binding DataContext.ToggleWatcherCommand, RelativeSource={RelativeSource AncestorType=dxr:RibbonControl}}"/>
 <dxb:BarButtonItem Content="Scan"
 LargeGlyph="{dx:DXImage SvgImages/Icon Builder/Find_Find.svg}"
 Command="{Binding DataContext.ScanCommand, RelativeSource={RelativeSource AncestorType=dxr:RibbonControl}}"/>
 <dxb:BarButtonItem Content="Execute"
 LargeGlyph="{dx:DXImage SvgImages/Arrows_Play.svg}"
 Command="{Binding DataContext.ExecuteSelectedCommand, RelativeSource={RelativeSource AncestorType=dxr:RibbonControl}}"/>
 <dxb:BarButtonItem Content="Undo"
 Glyph="{dx:DXImage SvgImages/History_Undo.svg}"
 Command="{Binding DataContext.UndoLastCommand, RelativeSource={RelativeSource AncestorType=dxr:RibbonControl}}"/>
 <dxb:BarButtonItem Content="Clear"
 Glyph="{dx:DXImage SvgImages/Icon Builder/Actions_Clear.svg}"
 Command="{Binding DataContext.ClearPreviewCommand, RelativeSource={RelativeSource AncestorType=dxr:RibbonControl}}"/>
 </dxr:RibbonPageGroup>
 <dxr:RibbonPageGroup Caption="Updates">
 <dxb:BarButtonItem Content="Update"
 LargeGlyph="{dx:DXImage SvgImages/Icon Builder/Actions_Refresh.svg}"
 Command="{Binding DataContext.CheckUpdateCommand, RelativeSource={RelativeSource AncestorType=dxr:RibbonControl}}"/>
 </dxr:RibbonPageGroup>
 </dxr:RibbonPage>
 </dxr:RibbonDefaultPageCategory>
 </dxr:RibbonControl>

 <!-- Status Bar (standard WPF to avoid ItemLinks issues) -->
 <StatusBar DockPanel.Dock="Bottom" Background="#FAFBFC" Height="28">
 <StatusBarItem>
 <TextBlock Text="Status:" Margin="0,0,6,0"/>
 </StatusBarItem>
 <StatusBarItem>
 <TextBlock Text="{Binding StatusMessage}"/>
 </StatusBarItem>
 <Separator />
 <StatusBarItem>
 <TextBlock Text="Done:" Margin="6,0,6,0"/>
 </StatusBarItem>
 <StatusBarItem>
 <TextBlock Text="{Binding ProcessedCount}"/>
 </StatusBarItem>
 <Separator />
 <StatusBarItem>
 <TextBlock Text="Queue:" Margin="6,0,6,0"/>
 </StatusBarItem>
 <StatusBarItem>
 <TextBlock Text="{Binding QueuedCount}"/>
 </StatusBarItem>
 </StatusBar>

 <!-- Main Content -->
 <dxdo:DockLayoutManager Margin="10">
 <dxdo:LayoutGroup Orientation="Horizontal">
 <dxdo:LayoutPanel Caption="Active Rules" ItemWidth="380">
 <dxg:GridControl ItemsSource="{Binding Rules}" SelectionMode="Row" Background="White">
 <dxg:GridControl.View>
 <dxg:TableView ShowGroupPanel="False"
 AutoWidth="True"
 AllowEditing="True"
 ShowIndicator="False"
 NavigationStyle="Cell"
 AlternateRowBackground="#F9FAFB"
 ShowSearchPanelMode="Always"
 ShowAutoFilterRow="True"/>
 </dxg:GridControl.View>
 <dxg:GridControl.Columns>
 <dxg:GridColumn FieldName="Enabled" Header="Active" Width="60"/>
 <dxg:GridColumn FieldName="Priority" Header="Priority" Width="70"/>
 <dxg:GridColumn FieldName="Name" Header="Rule Name" Width="160"/>
 <dxg:GridColumn FieldName="Category" Header="Category" Width="90"/>
 </dxg:GridControl.Columns>
 </dxg:GridControl>
 </dxdo:LayoutPanel>

 <dxdo:LayoutGroup Orientation="Vertical">
 <dxdo:LayoutPanel Caption="Preview / Results" ItemHeight="*">
 <dxg:GridControl ItemsSource="{Binding PreviewItems}" SelectionMode="Row" Background="White">
 <dxg:GridControl.View>
 <dxg:TableView ShowGroupPanel="False"
 AutoWidth="False"
 AllowEditing="False"
 ShowIndicator="True"
 NavigationStyle="Row"
 AlternateRowBackground="#F9FAFB"
 ShowSearchPanelMode="Always"
 ShowAutoFilterRow="True"
 AllowPerPixelScrolling="True"/>
 </dxg:GridControl.View>
 <dxg:GridControl.TotalSummary>
 <dxg:GridSummaryItem FieldName="IsSelected" SummaryType="Count" DisplayFormat="Items: {0}"/>
 </dxg:GridControl.TotalSummary>
 <dxg:GridControl.Columns>
 <dxg:GridColumn FieldName="IsSelected" Header="Select" Width="60"/>
 <dxg:GridColumn FieldName="Source.Name" Header="File Name" Width="240"/>
 <dxg:GridColumn FieldName="Source.Extension" Header="Type" Width="60"/>
 <dxg:GridColumn FieldName="Source.SizeBytes" Header="Size" Width="100"/>
 <dxg:GridColumn FieldName="ActionType" Header="Action" Width="70"/>
 <dxg:GridColumn FieldName="TargetPath" Header="Target Path" Width="350"/>
 <dxg:GridColumn FieldName="MatchedRule.Name" Header="Rule" Width="110"/>
 <dxg:GridColumn FieldName="Status" Header="Status" Width="80"/>
 </dxg:GridControl.Columns>
 </dxg:GridControl>
 </dxdo:LayoutPanel>

 <dxdo:LayoutPanel Caption="Recent Activity" ItemHeight="220">
 <dxg:GridControl ItemsSource="{Binding RecentLogs}" SelectionMode="Row" Background="White">
 <dxg:GridControl.View>
 <dxg:TableView ShowGroupPanel="False"
 AutoWidth="False"
 AllowEditing="False"
 ShowIndicator="False"
 NavigationStyle="Row"
 AlternateRowBackground="#F9FAFB"
 ShowSearchPanelMode="Always"
 ShowAutoFilterRow="True"
 RowDoubleClick="OnRecentLogDoubleClick"/>
 </dxg:GridControl.View>
 <dxg:GridControl.Columns>
 <dxg:GridColumn FieldName="Timestamp" Header="Time" Width="120">
 <dxg:GridColumn.CellTemplate>
 <DataTemplate>
 <TextBlock Text="{Binding RowData.Row.Timestamp, StringFormat='HH:mm:ss'}"
 ToolTip="{Binding RowData.Row.Timestamp, StringFormat='yyyy-MM-dd HH:mm:ss'}"
 FontFamily="Consolas"/>
 </DataTemplate>
 </dxg:GridColumn.CellTemplate>
 </dxg:GridColumn>
 <dxg:GridColumn FieldName="ActionType" Header="Action" Width="70"/>
 <dxg:GridColumn FieldName="SourcePath" Header="Source" Width="280">
 <dxg:GridColumn.CellTemplate>
 <DataTemplate>
 <TextBlock Text="{Binding RowData.Row.SourcePath}" TextTrimming="CharacterEllipsis" ToolTip="{Binding RowData.Row.SourcePath}"/>
 </DataTemplate>
 </dxg:GridColumn.CellTemplate>
 </dxg:GridColumn>
 <dxg:GridColumn FieldName="TargetPath" Header="Target" Width="280">
 <dxg:GridColumn.CellTemplate>
 <DataTemplate>
 <TextBlock Text="{Binding RowData.Row.TargetPath}" TextTrimming="CharacterEllipsis" ToolTip="{Binding RowData.Row.TargetPath}"/>
 </DataTemplate>
 </dxg:GridColumn.CellTemplate>
 </dxg:GridColumn>
 <dxg:GridColumn FieldName="RuleName" Header="Rule" Width="100"/>
 <dxg:GridColumn FieldName="Result" Header="Result" Width="90">
 <dxg:GridColumn.CellTemplate>
 <DataTemplate>
 <Border CornerRadius="10" Padding="8,3" HorizontalAlignment="Center">
 <Border.Style>
 <Style TargetType="Border">
 <Style.Triggers>
 <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Success">
 <Setter Property="Background" Value="#E8F5E9"/>
 </DataTrigger>
 <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Failed">
 <Setter Property="Background" Value="#FFEBEE"/>
 </DataTrigger>
 <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Skipped">
 <Setter Property="Background" Value="#FFF3E0"/>
 </DataTrigger>
 </Style.Triggers>
 </Style>
 </Border.Style>
 <TextBlock Text="{Binding RowData.Row.Result}" FontSize="10" FontWeight="Bold">
 <TextBlock.Style>
 <Style TargetType="TextBlock">
 <Style.Triggers>
 <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Success">
 <Setter Property="Foreground" Value="#2E7D32"/>
 </DataTrigger>
 <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Failed">
 <Setter Property="Foreground" Value="#C62828"/>
 </DataTrigger>
 <DataTrigger Binding="{Binding RowData.Row.Result}" Value="Skipped">
 <Setter Property="Foreground" Value="#EF6C00"/>
 </DataTrigger>
 </Style.Triggers>
 </Style>
 </TextBlock.Style>
 </TextBlock>
 </Border>
 </DataTemplate>
 </dxg:GridColumn.CellTemplate>
 </dxg:GridColumn>
 <dxg:GridColumn Width="90">
 <dxg:GridColumn.CellTemplate>
 <DataTemplate>
 <Button Content="Open"
 Command="{Binding DataContext.OpenFolderCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
 CommandParameter="{Binding RowData.Row}"
 Padding="8,4"
 FontSize="11"
 FontWeight="SemiBold"
 Background="{StaticResource PrimaryButtonBrush}"
 Foreground="White"
 BorderThickness="0"
 Cursor="Hand"/>
 </DataTemplate>
 </dxg:GridColumn.CellTemplate>
 </dxg:GridColumn>
 </dxg:GridControl.Columns>
 </dxg:GridControl>
 </dxdo:LayoutPanel>
 </dxdo:LayoutGroup>
 </dxdo:LayoutGroup>
 </dxdo:DockLayoutManager>
 </DockPanel>
</dx:ThemedWindow>
